<div class="student-list">
  <div class="header-with-button">
    <h2>Students</h2>
    <app-add-button
      [isOpen]="showAddForm()"
      [ariaLabel]="showAddForm() ? 'Close add student form' : 'Open add student form'"
      (clicked)="toggleAddForm()"
    ></app-add-button>
  </div>

  @if (showAddForm()) {
    <app-student-form
      [student]="editingStudent()"
      (studentCreated)="onStudentCreated($event)"
      (studentUpdated)="onStudentUpdated($event)"
      (cancelled)="onFormCancelled()"
    ></app-student-form>
  } @else {
    @if (loading()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading students...</p>
      </div>
    }

    @if (errorMessage()) {
      <div class="error-message">
        {{ errorMessage() }}
      </div>
    }

    @if (!loading() && students().length === 0 && !errorMessage()) {
      <div class="empty-state">
        <p>No students found. Click + to add your first student.</p>
      </div>
    }

    @if (!loading() && students().length > 0) {
    <div class="students-grid">
      @for (student of students(); track student.id) {
        <div
          class="student-card"
          [class.selected]="isSelected(student)"
          (click)="selectStudent(student)"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Select student ' + student.name"
        >
          <div class="card-header">
            <h3>{{ student.name }}</h3>
            @if (student.id) {
              <div class="menu-container">
                <button
                  class="kebab-btn"
                  (click)="toggleMenu($event, student.id)"
                  [attr.aria-expanded]="openMenuId() === student.id"
                  aria-label="Open menu"
                >
                  <span class="kebab-icon">â‹®</span>
                </button>
                @if (openMenuId() === student.id) {
                  <div class="dropdown-menu">
                    <button class="menu-item" (click)="editStudent($event, student)">
                      Edit
                    </button>
                    <button class="menu-item delete" (click)="deleteStudent($event, student.id)">
                      Delete
                    </button>
                  </div>
                }
              </div>
            }
          </div>
          <p class="grade">{{ student.grade }}</p>
          <p class="school">{{ student.school }}</p>
        </div>
      }
    </div>
    }
  }
</div>
